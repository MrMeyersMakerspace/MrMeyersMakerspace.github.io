<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <!--Link for Dosis Font-->
    <link href="https://fonts.googleapis.com/css?family=Dosis&display=swap" rel="stylesheet" />
    <!--Link for social media icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <!--Link for nav icon-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <title>Resistor Calculator</title>
</head>

<body onload="getValues()">
    <div id="page-container">
        <div id="content-wrap">
            <header>
                <h1 id="pageName">Resistor Calculator</h1>
            </header>

            <!--Number of Bands Selector-->
            <select id="numBands" onchange="numColors(this)">
                <option value=4>4 Bands</option>
                <option value=5>5 Bands</option>
                <option value=6>6 Bands</option>
            </select>

            <!--Display for the Bands-->
            <div id="bandDIVs" class="flexContainer1">
                <div id="band1" class="band"></div>
                <div id="band2" class="band"></div>
                <div id="band3" class="band"></div>
                <div id="band4" class="band"></div>
            </div>

            <!--Selectors for the colors for each band-->
            <div id="colorSelector" class="flexContainer2">
                <select id="bandColor1" class="selectorBox" onchange="changeColors(1)">
                    <option value=0 style="background-color: black; color: white;">Black</option>
                    <option value=1 style="background-color: brown; color: white;">Brown</option>
                    <option value=2 style="background-color: red; color: black;">Red</option>
                    <option value=3 style="background-color: orange; color: black;">Orange</option>
                    <option value=4 style="background-color: yellow; color: black;">Yellow</option>
                    <option value=5 style="background-color: green; color: black;">Green</option>
                    <option value=6 style="background-color: blue; color: white;">Blue</option>
                    <option value=7 style="background-color: violet; color: black;">Violet</option>
                    <option value=8 style="background-color: grey; color: white;">Grey</option>
                    <option value=9 style="background-color: white; color: black;">White</option>
                </select>
                <select id="bandColor2" class="selectorBox" onchange="changeColors(2)">
                    <option value=0 style="background-color: black; color: white;">Black</option>
                    <option value=1 style="background-color: brown; color: white;">Brown</option>
                    <option value=2 style="background-color: red; color: black;">Red</option>
                    <option value=3 style="background-color: orange; color: black;">Orange</option>
                    <option value=4 style="background-color: yellow; color: black;">Yellow</option>
                    <option value=5 style="background-color: green; color: black;">Green</option>
                    <option value=6 style="background-color: blue; color: white;">Blue</option>
                    <option value=7 style="background-color: violet; color: black;">Violet</option>
                    <option value=8 style="background-color: grey; color: white;">Grey</option>
                    <option value=9 style="background-color: white; color: black;">White</option>
                </select>
                <select id="bandColor3" class="selectorBox" onchange="changeColors(3)">
                    <option value=0 style="background-color: black; color: white;">Black</option>
                    <option value=1 style="background-color: brown; color: white;">Brown</option>
                    <option value=2 style="background-color: red; color: black;">Red</option>
                    <option value=3 style="background-color: orange; color: black;">Orange</option>
                    <option value=4 style="background-color: yellow; color: black;">Yellow</option>
                    <option value=5 style="background-color: green; color: black;">Green</option>
                    <option value=6 style="background-color: blue; color: white;">Blue</option>
                    <option value=7 style="background-color: violet; color: black;">Violet</option>
                    <option value=8 style="background-color: grey; color: white;">Grey</option>
                    <option value=9 style="background-color: white; color: black;">White</option>
                </select>
                <select id="bandColor4" class="selectorBox" onchange="changeColors(4)">
                    <option value=0.01 style="background-color: silver; color: black;">Silver</option>
                    <option value=0.1 style="background-color: gold; color: black;">Gold</option>
                    <option value=1 style="background-color: black; color: white;" selected>Black</option>
                    <option value=10 style="background-color: brown; color: white;">Brown</option>
                    <option value=100 style="background-color: red; color: black;">Red</option>
                    <option value=1000 style="background-color: orange; color: black;">Orange</option>
                    <option value=10000 style="background-color: yellow; color: black;">Yellow</option>
                    <option value=100000 style="background-color: green; color: black;">Green</option>
                    <option value=1000000 style="background-color: blue; color: white;">Blue</option>
                    <option value=10000000 style="background-color: violet; color: black;">Violet</option>
                </select>
                <select id="bandColor5" class="selectorBox" onchange="changeColors(5)">
                    <option value=10 style="background-color: silver; color: black;">Silver</option>
                    <option value=5 style="background-color: gold; color: black;">Gold</option>
                    <option value=1 style="background-color: brown; color: white;" selected>Brown</option>
                    <option value=2 style="background-color: red; color: black;">Red</option>
                    <option value=0.5 style="background-color: green; color: black;">Green</option>
                    <option value=0.25 style="background-color: blue; color: white;">Blue</option>
                    <option value=0.1 style="background-color: violet; color: black;">Violet</option>
                    <option value=0.05 style="background-color: grey; color: white;">Grey</option>
                </select>
                <select id="bandColor6" class="selectorBox" onchange="changeColors(6)">
                    <option value=100 style="background-color: brown; color: white;">Brown</option>
                    <option value=50 style="background-color: red; color: black;">Red</option>
                    <option value=15 style="background-color: orange; color: black;">Orange</option>
                    <option value=25 style="background-color: yellow; color: black;">Yellow</option>
                    <option value=10 style="background-color: blue; color: white;">Blue</option>
                    <option value=5 style="background-color: violet; color: black;">Violet</option>
                </select>
            </div>

            <p style="text-decoration: underline; font-weight: bold;">Current Resistor Value</p>
            <p id="resistorValue"></p>
            <br>
            <button type="button" onclick="saveValue()">Save Resistor Value</button>
            <br><br>
            <table id="valuesTable"></table>
        </div>
        <footer>
            <div class="footer-center">
                ©2019 Copyright Maker Meyers
            </div>
            <div class="footer-center">
                <a href="https://www.instagram.com/mrmeyersmakerspace/" class="ifoot fa fa-instagram"></a>
                <a href="https://github.com/MrMeyersMakerspace" class="ifoot fa fa-github"></a>
            </div>
        </footer>
    </div>

    <script>
        var bandDIV = document.getElementById("bandDIVs");
        // Store the number of bands of the given resistor
        var numBands = 4;
        // Store current resistor value
        var resistorValue;
        // Create resistor array
        var resistors = [
            {
                numBands: 4,
                color1: "Brown",
                color2: "Black",
                color3: "Brown",
                color4: "Brown",
                value: "100 Ω ± 1%"
            }
        ];

        // Changes the colors of the bands when a color is selected and updates resistor value
        function changeColors(band) {
            // Updates the resistor value
            updateValue();

            var element = document.getElementById(`bandColor${band}`);

            // Have to adjust the process for only 4 bands so this check fixes the process
            if (numBands == 4) {
                if (band < 3) {
                    bandDIV.children[band - 1].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                } else {
                    bandDIV.children[band - 2].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                }
            } else {
                bandDIV.children[band - 1].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
            }
        }

        // Change the number of bands when a new number is selected and make sure they are the right color
        function numColors(bands) {
            numBands = bands.value;
            console.log(`The number of bands is:  ${numBands}`);
            // Change number of divs to # bands depending on selection
            switch (Number(numBands)) {
                case 4:
                    console.log("Switch value 4 called");
                    console.log(`Child Element Count = ${bandDIV.childElementCount}`);
                    // Check how many DIVs are present and change it to 5
                    // When there are 4 DIVs present add one
                    if (bandDIV.childElementCount == 5) {
                        bandDIV.removeChild(bandDIV.lastChild);
                    }
                    // When there are 6 DIVs present remove the last one
                    if (bandDIV.childElementCount == 6) {
                        bandDIV.removeChild(bandDIV.lastChild);
                        bandDIV.removeChild(bandDIV.lastChild);
                    }

                    // Mirror the band color with the selected color
                    for (var i = 0; i < 5; i++) {
                        var element = document.getElementById(`bandColor${i + 1}`);
                        console.log(element.options.item(element.options.selectedIndex).text)

                        // Check to fix the color for when there are only 4 selected
                        if (i < 2) {
                            bandDIV.children[i].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                        }
                        if (i > 2) {
                            bandDIV.children[i - 1].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                        }
                    }

                    // Show bands 1, 2, 4, and 5 only
                    document.getElementById("bandColor3").style.display = "none";
                    document.getElementById("bandColor5").style.display = "block";
                    document.getElementById("bandColor6").style.display = "none";
                    break;

                case 5:
                    console.log("Switch value 5 called");
                    console.log(`Child Element Count = ${bandDIV.childElementCount}`);
                    // Check how many DIVs are present and change it to 5
                    // When there are 4 DIVs present add one
                    if (bandDIV.childElementCount == 4) {
                        var newDIV = document.createElement("DIV");
                        newDIV.id = "band5";
                        newDIV.className = "band";
                        newDIV.style.backgroundColor = "silver";
                        bandDIV.appendChild(newDIV);
                    }
                    // When there are 6 DIVs present remove the last one
                    if (bandDIV.childElementCount == 6) {
                        bandDIV.removeChild(bandDIV.lastChild);
                    }

                    // Mirror the band color with the selected color
                    for (var i = 0; i < 5; i++) {
                        var element = document.getElementById(`bandColor${i + 1}`);
                        console.log(element.options.item(element.options.selectedIndex).text)
                        bandDIV.children[i].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                    }

                    // Show bands 1, 2, 3, 4, and 5 only
                    document.getElementById("bandColor3").style.display = "block";
                    document.getElementById("bandColor5").style.display = "block";
                    document.getElementById("bandColor6").style.display = "none";
                    break;

                case 6:
                    console.log("Switch value 6 called");
                    console.log(`Child Element Count = ${bandDIV.childElementCount}`);
                    // Check how many DIVs are present and change it to 6
                    // When there are 4 DIVs present add two
                    if (bandDIV.childElementCount == 4) {
                        // Add first div
                        var newDIV = document.createElement("DIV");
                        newDIV.id = "band5";
                        newDIV.className = "band";
                        newDIV.style.backgroundColor = "silver";
                        bandDIV.appendChild(newDIV);


                        // Add second div
                        var newDIV2 = document.createElement("DIV");
                        newDIV2.id = "band6";
                        newDIV2.className = "band";
                        newDIV2.style.backgroundColor = "brown";
                        bandDIV.appendChild(newDIV);
                    }
                    // When there are 5 DIVs present add one
                    if (bandDIV.childElementCount == 5) {
                        // Add div
                        var newDIV = document.createElement("DIV");
                        newDIV.id = "band6";
                        newDIV.className = "band";
                        newDIV.style.backgroundColor = "brown";
                        bandDIV.appendChild(newDIV);
                    }

                    // Mirror the band color with the selected color
                    for (var i = 0; i < 5; i++) {
                        var element = document.getElementById(`bandColor${i + 1}`);
                        console.log(element.options.item(element.options.selectedIndex).text)
                        bandDIV.children[i].style.backgroundColor = element.options.item(element.options.selectedIndex).text;
                    }

                    // Show all 6 bands
                    document.getElementById("bandColor3").style.display = "block";
                    document.getElementById("bandColor5").style.display = "block";
                    document.getElementById("bandColor6").style.display = "block";
                    break;
                default:
                    console.log("Switch choices failed");
                    break;
            }

            // Update the resistor values
            updateValue();
        }

        // Updates the resistor value based on current colors selected
        function updateValue() {
            var band1 = document.getElementById("bandColor1");
            var band2 = document.getElementById("bandColor2");
            var band3 = document.getElementById("bandColor3");
            var band4 = document.getElementById("bandColor4");
            var band5 = document.getElementById("bandColor5");
            var band6 = document.getElementById("bandColor6");

            // Algorithm changes depending on the number of bands
            switch (Number(numBands)) {
                case 4:
                    // Add first two band numbers together as strings
                    resistorValue = String(band1.value) + String(band2.value);
                    // Multiply by the multiplier
                    resistorValue = Number(resistorValue) * Number(band4.value);
                    // Add the tolerance
                    resistorValue = String(resistorValue) + " Ω ± " + String(band5.value) + "%";
                    document.getElementById("resistorValue").innerHTML = resistorValue;
                    break;

                case 5:
                    // Add first three band numbers together as strings
                    resistorValue = String(band1.value) + String(band2.value) + String(band3.value);
                    // Multiply by the multiplier
                    resistorValue = Number(resistorValue) * Number(band4.value);
                    // Add the tolerance
                    resistorValue = String(resistorValue) + " Ω ± " + String(band5.value) + "%";
                    document.getElementById("resistorValue").innerHTML = resistorValue;
                    break;
                case 6:
                    // Add first three band numbers together as strings
                    resistorValue = String(band1.value) + String(band2.value) + String(band3.value);
                    // Multiply by the multiplier
                    resistorValue = Number(resistorValue) * Number(band4.value);
                    // Add the tolerance
                    resistorValue = String(resistorValue) + " Ω ± " + String(band5.value) + "% " + String(band6.value) + " ppm";
                    document.getElementById("resistorValue").innerHTML = resistorValue;
                    break;
                    break;
            }
        }

        // Save's current resistor value to localStorage
        function saveValue() {
            var band1 = document.getElementById("bandColor1");
            var band2 = document.getElementById("bandColor2");
            var band3 = document.getElementById("bandColor3");
            var band4 = document.getElementById("bandColor4");
            var band5 = document.getElementById("bandColor5");
            var band6 = document.getElementById("bandColor6");

            switch (Number(numBands)) {
                case 4:
                    // Create a new resistor object
                    var newResistor = {
                        numBands: 4,
                        color1: band1.options.item(band1.options.selectedIndex).text,
                        color2: band2.options.item(band2.options.selectedIndex).text,
                        color3: band4.options.item(band4.options.selectedIndex).text,
                        color4: band5.options.item(band5.options.selectedIndex).text,
                        value: resistorValue
                    };

                    // Add new resistor to array of resistor objects
                    resistors.push(newResistor);

                    // Store resistors in local storage
                    localStorage.setItem("resistors", JSON.stringify(resistors));
                    console.log(JSON.stringify(resistors));
                    console.log(resistors);
                    break;

                case 5:
                    // Create a new resistor object
                    var newResistor = {
                        numBands: 5,
                        color1: band1.options.item(band1.options.selectedIndex).text,
                        color2: band2.options.item(band2.options.selectedIndex).text,
                        color3: band3.options.item(band3.options.selectedIndex).text,
                        color4: band4.options.item(band4.options.selectedIndex).text,
                        color5: band5.options.item(band5.options.selectedIndex).text,
                        value: resistorValue
                    };
                    // Add new resistor to array of resistor objects
                    resistors.push(newResistor);

                    // Store resistors in local storage
                    localStorage.setItem("resistors", JSON.stringify(resistors));
                    console.log(JSON.stringify(resistors));
                    console.log(resistors);
                    break;

                case 6:
                    // Create a new resistor object
                    var newResistor = {
                        numBands: 6,
                        color1: band1.options.item(band1.options.selectedIndex).text,
                        color2: band2.options.item(band2.options.selectedIndex).text,
                        color3: band3.options.item(band3.options.selectedIndex).text,
                        color4: band4.options.item(band4.options.selectedIndex).text,
                        color5: band5.options.item(band5.options.selectedIndex).text,
                        color6: band6.options.item(band6.options.selectedIndex).text,
                        value: resistorValue
                    };
                    // Add new resistor to array of resistor objects
                    resistors.push(newResistor);

                    // Store resistors in local storage
                    localStorage.setItem("resistors", JSON.stringify(resistors));
                    console.log(JSON.stringify(resistors));
                    console.log(resistors);
                    break;
            }
            renderValues();
        }

        // Gets all the resistors in localStorage and displays them
        function getValues() {
            // Get resistor values from localStorage
            var oldResistors = localStorage.getItem("resistors");
            console.log(oldResistors);
            // Parse resistor values into an object
            oldResistors = JSON.parse(oldResistors);
            console.log(oldResistors);

            if (oldResistors !== null) {
                // Push localStorage resistor values to local resistor object
                for (var i = 1; i < oldResistors.length; i++) {
                    resistors.push(oldResistors[i]);
                }
            }
            console.log(resistors);
            updateValue();
            renderValues();
        }

        // Displays the stored values in a table
        function renderValues() {
            var myTable = document.getElementById("valuesTable");
            myTable.innerHTML = `<tr>
            <th>Color Bands</th>
            <th>Resistor Value</th>
            </tr>
            <tr>`;

            for (var i = 0; i < resistors.length; i++) {
                switch (Number(resistors[i].numBands)) {
                    case 4:
                        myTable.innerHTML += `<td class="flexContainer3">
                        <div class="bands" style="background-color: ${resistors[i].color1};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color2};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color3};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color4};"></div>
                        </td>
                        <td class="rowValue">${resistors[i].value}</td>
                        </tr>`;
                        break;
                    case 5:
                        myTable.innerHTML += `<td class="flexContainer3">
                        <div class="bands" style="background-color: ${resistors[i].color1};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color2};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color3};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color4};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color5};"></div>
                        </td>
                        <td class="rowValue">${resistors[i].value}</td>
                        </tr>`;
                        break;
                    case 6:
                    myTable.innerHTML += `<td class="flexContainer3">
                        <div class="bands" style="background-color: ${resistors[i].color1};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color2};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color3};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color4};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color5};"></div>
                        <div class="bands" style="background-color: ${resistors[i].color6};"></div>
                        </td>
                        <td class="rowValue">${resistors[i].value}</td>
                        </tr>`;
                        break;
                }
                console.log(resistors.length);
                console.log(resistors[i].numBands);
            }
        }
    </script>
</body>

</html>